<script>
var member = <%- JSON.stringify(request.user)%>;
</script>
<form method="get" action="/logout" style="display: none;">
	<fieldset>
		<button type="submit">Sign out</button>
	</fieldset>
</form>
<div id="messagesView" class="centered content view">
	<ol class="discussion">
		<li class="other">
			<div class="avatar">
				<img data-src="{{from.avatar}}" />
			</div>
			<div class="message">
				<article>{{{text}}}</article>
				<time datetime="{{time}}">{{time}}</time>
			</div>
		</li>
		<% 
			var current = null;
			var next = {username: null};
			var i = 0;
			var ubounds = model ? model.length : 0;
			for(i; i < ubounds; i++){
				var message = model[i];
				current = message.from;
				if(current.username !== next.username){
		%>
		<li class="<%= current.username === request.user.username ? 'self' : 'other'%>">
			<time datetime="<%= message.w3cFormat(message.time) %>"><%= message.humanFriendlyDate(message.time) %></time>
			<div class="avatar">
				<img data-src="<%= message.from.avatar %>" src="<%= message.from.avatar %>" />
			</div>
		<%
				}
		%>
			<div class="message">
				<article><%= message.text %></article>
				<time datetime="<%= message.w3cFormat(message.time) %>" class="today"><%= message.humanFriendlyDate(message.time) %></time>
			</div>
		<%
				next = i+1 < model.length ? model[i+1].from : {username: null};
				if(current.username !== next.username){
		%>
		</li>
		<%
				}
			}
		%>
	</ol>
</div>
<div id="rosterView" class="right nav view" style="display: none;">
	<ul>
		<li>
			<img data-src="{{avatar}}" />
			<label>{{username}}</label>
		</li>
	</ul>
</div>
<footer id="comment" class="comment">
	<form>
		<fieldset>
			<legend></legend>
			<textarea name="message"></textarea>
			<button type="submit">Send</button>
		</fieldset>
	</form>
</footer>
